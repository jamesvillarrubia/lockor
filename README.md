# Lockor üîí

**Lockor** (cursOR + LOCKer) is a comprehensive VS Code and Cursor extension that prevents AI tools and users from modifying protected files. Perfect for safeguarding configuration files, templates, or any critical files you want to keep unchanged during development.

## ‚ú® Key Features

### üîí **File Protection System**
- **Smart Protection Levels**: Soft, AI-Aware, and Hard modes for different use cases
- **Lock/Unlock Files**: Easily toggle file protection status
- **Persistent State**: Lock states remembered across VS Code sessions
- **Workspace Scoped**: Protection settings per workspace

### ü§ñ **AI Integration & Blocking**
- **Cursor Rules Integration**: Automatically updates `.cursor/rules/lockor.mdc` with protection rules
- **Mode-Specific AI Instructions**: Different blocking strategies for each protection level
- **Pre-Check Procedures**: Forces AI to verify file status before any operations
- **Context Keys**: Exposes lock status to VS Code's context system

### üìÅ **Multiple AI Visibility Layers**
- **`.lockor` YAML Status File**: Clean, structured record of all protected files
- **Language-Aware File Markers**: Optional comment headers in appropriate syntax for each file type
- **Workspace Diagnostics**: Shows lock warnings in VS Code Problems panel
- **Status Bar Integration**: Visual indicator of current file's protection status

### ‚öôÔ∏è **Advanced Configuration**
- **Flexible Protection Levels**: Choose the right level of protection for your needs
- **Optional Features**: Enable/disable file markers, status files, notifications
- **Hard Mode Conflict Detection**: Intelligent handling of incompatible feature combinations
- **Debounced Notifications**: Prevents notification spam during editing

## üéØ Protection Levels

| Level | AI Instructions | User Experience | Save Blocking | OS Read-Only |
|-------|----------------|------------------|---------------|--------------|
| **Soft** | üü° Gentle reminders | ‚ö†Ô∏è Warnings only | ‚ùå No | ‚ùå No |
| **AI-Aware** (default) | üî¥ Strict blocking | ‚ö†Ô∏è Warnings only | ‚ùå No | ‚ùå No |
| **Hard** | üî¥ Strict blocking | üî¥ Hard blocked | ‚úÖ Yes | ‚úÖ Yes |

### When to Use Each Level:
- **üü° Soft**: Light protection - gentle reminders for everyone, no blocking
- **üî¥ AI-Aware**: AI protection only - humans can save with warnings, AI is strictly blocked *(recommended)*
- **‚ö´ Hard**: Maximum protection - everyone is blocked, OS read-only permissions

## üöÄ Usage

### Basic File Locking

1. **From Editor**: Use `Cmd+Shift+P` ‚Üí "Lockor: Toggle File Lock"
2. **From Explorer**: Right-click file ‚Üí "Toggle File Lock"  
3. **Keyboard Shortcut**: `Cmd+Shift+L` (Mac) or `Ctrl+Shift+L` (Windows/Linux)

### Available Commands

- `Lockor: Lock File` - Lock the currently active file
- `Lockor: Unlock File` - Unlock the currently active file
- `Lockor: Toggle File Lock` - Toggle lock status of current file
- `Lockor: Show Locked Files` - View and manage all locked files

### Status Bar Indicator

- üîí **Gold "LOCKED"** - File is protected (warning background)
- üîì **"UNLOCKED"** - File can be modified (auto-hides after 2 seconds)

## ‚öôÔ∏è Configuration

Access via `File > Preferences > Settings` ‚Üí search "Lockor":

### Core Settings

```json
{
  "lockor.protectionLevel": "ai-aware",    // "soft" | "ai-aware" | "hard"
  "lockor.showStatusBarItem": true,        // Show status bar indicator
  "lockor.showNotifications": true         // Show lock/unlock notifications
}
```

### Advanced Features

```json
{
  "lockor.createStatusFile": true,         // Generate .lockor YAML file
  "lockor.addVisibleMarkers": false        // Add comment headers to files
}
```

**Note**: `addVisibleMarkers` is automatically disabled in Hard mode due to read-only conflicts.

## ü§ñ AI Integration Details

### Cursor Rules (`.cursor/rules/lockor.mdc`)

Lockor automatically generates mode-specific rules:

**Soft Mode Example:**
```markdown
---
description: "NOTICE: These files are marked as \"soft\" protected by Lockor..."
globs:
  - "config.js"
alwaysApply: true
---

# PROTECTED FILES - PLEASE AVOID EDITING

## RECOMMENDED RESPONSE
1. **REMIND THE USER**: 'This file is marked as "soft" protected...'
2. **OFFER OPTIONS**: Suggest 1) unlocking 2) alternative path, or 3) proceed anyway
3. **RESPECT THEIR CHOICE**: If they confirm, you may proceed
```

**AI-Aware/Hard Mode Example:**
```markdown
---
description: "CRITICAL: You MUST NOT modify these locked files..."
---

# LOCKED FILES - DO NOT EDIT

## MANDATORY PRE-CHECK PROCEDURE
**BEFORE performing ANY file operation, you MUST:**
1. **CHECK** if the target file matches any locked file pattern
2. **VERIFY** the file path against the locked files list
3. **STOP IMMEDIATELY** if the file is locked
```

### .lockor Status File

```yaml
# ‚ö†Ô∏è  DO NOT EDIT THIS FILE MANUALLY
# This file is automatically generated by the Lockor VS Code extension

version: "1.0"
generated: "2024-01-15T10:30:00.000Z"
protection_level: "ai-aware"
total_locked_files: 2

locked_files:
  - path: "src/config.js"
    absolute: "/full/path/to/src/config.js"
  - path: ".env"
    absolute: "/full/path/to/.env"

protection_info:
  mode: "ai-aware"
  description: "AI blocked, humans can save with warnings"
  ai_instructions: "STRICTLY PROHIBITED - Do not modify these files"
  save_blocking: false
  os_readonly: false
```

### Language-Aware File Markers

When `addVisibleMarkers` is enabled, Lockor adds appropriate comment headers:

```javascript
/* üîí LOCKOR: This file is LOCKED and should NOT be modified! */
// Your JavaScript code...
```

```python
# üîí LOCKOR: This file is LOCKED and should NOT be modified!
# Your Python code...
```

```html
<!-- üîí LOCKOR: This file is LOCKED and should NOT be modified! -->
<!-- Your HTML content... -->
```

**Supported Languages**: JavaScript, TypeScript, Python, Shell, HTML, CSS, SQL, MATLAB, LaTeX, Vim, and many more.

## üì¶ Installation

### From Open VSX Registry *(Coming Soon)*
1. Open VS Code Extensions (`Ctrl+Shift+X`)
2. Search for "Lockor"
3. Click Install

**Alternative Sources:**
- **Open VSX**: https://open-vsx.org/extension/lockor/lockor
- **VS Code Marketplace**: *(Coming Soon)*

### Manual Installation
1. Download the `.vsix` file from [GitHub Releases](https://github.com/jamesvillarrubia/lockor/releases)
2. Open VS Code
3. Run `Extensions: Install from VSIX...` from Command Palette
4. Select the downloaded file

### Development Installation
```bash
git clone https://github.com/jamesvillarrubia/lockor.git
cd lockor
pnpm install
pnpm run compile
# Press F5 to launch Extension Development Host
```

## üõ†Ô∏è How It Works

### Multi-Layer Protection System

1. **State Management**: Tracks locked files in VS Code workspace storage
2. **Save Interception**: Uses `onWillSaveTextDocument` event to block saves (Hard mode)
3. **File Permissions**: Sets OS-level read-only permissions (Hard mode only)
4. **AI Communication**: Multiple channels ensure AI awareness:
   - Cursor rules with mandatory pre-check procedures
   - Context keys for VS Code extensions
   - Workspace diagnostics in Problems panel
   - Optional YAML status file and file markers

### Protection Level Behavior

- **Soft**: Warning notifications, gentle AI discouragement
- **AI-Aware**: Strict AI blocking, human warnings, no save blocking
- **Hard**: Everyone blocked, OS read-only, save prevention

### Conflict Resolution

- **Hard + File Markers**: Shows warning and offers to switch modes or disable markers
- **Session Tracking**: AI-Aware mode shows edit warnings only once per file per session
- **Debounced Notifications**: Prevents spam during rapid typing (2-second delay)

## üöß Limitations

- **Workspace Scope**: Lock states are per-workspace, not global
- **External Modifications**: Only VS Code saves are blocked (Soft/AI-Aware modes)
- **Team Sharing**: Lock states aren't shared between team members
- **AI Compliance**: Depends on AI tools respecting cursor rules and context

## ü§ù Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests if applicable
5. Submit a pull request

## üìÑ License

Apache 2.0 License - see [LICENSE](LICENSE) file for details.

## üîó Links

- **GitHub**: https://github.com/jamesvillarrubia/lockor
- **Issues**: https://github.com/jamesvillarrubia/lockor/issues
- **VS Code Marketplace**: *(Coming Soon)*

---

*Lockor: Protecting your code from unintended changes, one file at a time.* üîí‚ú®